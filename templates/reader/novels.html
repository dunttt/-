{% extends "base-ancient.html" %}

{% block title %}å°è¯´å¹¿åœº - æ‚¦è¯»åŠ{% endblock %}

{% block content %}
<h1 class="page-title" style="text-align: left;">å°è¯´å¹¿åœº</h1>

<!-- æœç´¢å’Œç­›é€‰ -->
<div class="card">
    <form method="GET" action="{{ url_for('reader_novels') }}">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
            <!-- æœç´¢æ¡† -->
            <div style="flex: 1; min-width: 300px;">
                <input type="text" 
                       name="keyword" 
                       class="form-control" 
                       placeholder="ğŸ” æœç´¢ä¹¦åã€ä½œè€…ã€æ ‡ç­¾..." 
                       value="{{ keyword if keyword else '' }}">
            </div>
            
            <!-- åˆ†ç±» -->
            <select name="category" class="form-select" style="width: 150px;" onchange="this.form.submit()">
                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if cat == current_category %}selected{% endif %}>{{ cat }}</option>
                {% endfor %}
            </select>
            
            <!-- æŒ‰é’® -->
            <button type="submit" class="btn btn-primary">æœç´¢</button>
            {% if keyword or current_category %}
            <a href="{{ url_for('reader_novels') }}" class="btn btn-secondary">æ¸…ç©ºç­›é€‰</a>
            {% endif %}
        </div>
        
        <!-- æœç´¢ç»“æœæç¤º -->
        {% if keyword %}
        <div style="padding: 0.75rem 1rem; background: rgba(200, 85, 61, 0.1); border-left: 4px solid #c8553d; border-radius: 8px; color: #5a4a3a;">
            <strong>ğŸ” æœç´¢ç»“æœï¼š</strong>å…³é”®è¯"<span style="font-weight: bold; color: #c8553d;">{{ keyword }}</span>"
            {% if current_category %}
            + åˆ†ç±»"<span style="font-weight: bold; color: #c8553d;">{{ current_category }}</span>"
            {% endif %}
            æ‰¾åˆ° <span style="font-weight: bold; color: #c8553d;">{{ total_results }}</span> éƒ¨å°è¯´
        </div>
        {% endif %}
    </form>
</div>

<!-- å°è¯´åˆ—è¡¨ -->
{% if novels %}
<div class="novels-grid">
    {% for novel in novels %}
    <div class="novel-card" onclick="window.location.href='{{ url_for('reader_novel_detail', novel_id=novel._id) }}'">
        <div class="novel-cover" style="background: linear-gradient(135deg, 
            {% if loop.index0 % 6 == 0 %}#c8553d 0%, #a0442f 100%
            {% elif loop.index0 % 6 == 1 %}#8b7355 0%, #6d5c47 100%
            {% elif loop.index0 % 6 == 2 %}#5f9e6e 0%, #4a7c58 100%
            {% elif loop.index0 % 6 == 3 %}#d4a259 0%, #b8894a 100%
            {% elif loop.index0 % 6 == 4 %}#7a92a3 0%, #5d7386 100%
            {% else %}#9b6b6f 0%, #7d5659 100%{% endif %});">
            {{ novel.title[:2] }}
        </div>
        <div class="novel-info">
            <div class="novel-title">{{ novel.title }}</div>
            <div class="novel-meta">
                <span class="badge badge-primary">{{ novel.category }}</span>
                <span>âœï¸ {{ novel.author_name }}</span>
            </div>
            <div class="novel-meta">
                <span>ğŸ“– {{ novel.chapters|length }} ç« </span>
                <span>ğŸ‘ï¸ {{ novel.readCount }}</span>
                {% if novel.price > 0 %}
                <span style="color: #c8553d; font-weight: bold;">Â¥{{ '%.2f'|format(novel.price) }}</span>
                {% else %}
                <span class="badge badge-success">å…è´¹</span>
                {% endif %}
            </div>
            <div class="novel-intro">{{ novel.intro }}</div>
            <button class="btn btn-primary" style="width: 100%;" onclick="event.stopPropagation(); window.location.href='{{ url_for('reader_novel_detail', novel_id=novel._id) }}'">æŸ¥çœ‹è¯¦æƒ…</button>
        </div>
    </div>
    {% endfor %}
</div>

<!-- åˆ†é¡µ -->
{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="?page={{ page - 1 }}{% if current_category %}&category={{ current_category }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}">ä¸Šä¸€é¡µ</a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
        <span class="active">{{ p }}</span>
        {% else %}
        <a href="?page={{ p }}{% if current_category %}&category={{ current_category }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}">{{ p }}</a>
        {% endif %}
    {% endfor %}

    {% if page < total_pages %}
    <a href="?page={{ page + 1 }}{% if current_category %}&category={{ current_category }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}">ä¸‹ä¸€é¡µ</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <div class="icon">ğŸ“š</div>
    <h3>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å°è¯´</h3>
    <p>å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æˆ–æ¸…ç©ºç­›é€‰æ¡ä»¶</p>
    <a href="{{ url_for('reader_novels') }}" class="btn btn-primary">æµè§ˆå…¨éƒ¨å°è¯´</a>
</div>
{% endif %}
{% endblock %}
