{% extends "base-ancient.html" %}

{% block title %}å®¡æ ¸å°è¯´ - æ‚¦è¯»åŠ{% endblock %}

{% block content %}
<h1 class="page-title" style="text-align: left;">ğŸ“ å®¡æ ¸å°è¯´</h1>

<div class="card">
    {% if novels %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #faf8f3; border-bottom: 2px solid #f0e6d6;">
                    <th style="padding: 1rem; text-align: left; color: #5a4a3a; font-weight: 600;">å°è¯´ID</th>
                    <th style="padding: 1rem; text-align: left; color: #5a4a3a; font-weight: 600;">æ ‡é¢˜</th>
                    <th style="padding: 1rem; text-align: center; color: #5a4a3a; font-weight: 600;">ä½œè€…</th>
                    <th style="padding: 1rem; text-align: center; color: #5a4a3a; font-weight: 600;">åˆ†ç±»</th>
                    <th style="padding: 1rem; text-align: center; color: #5a4a3a; font-weight: 600;">ç« èŠ‚æ•°</th>
                    <th style="padding: 1rem; text-align: center; color: #5a4a3a; font-weight: 600;">æäº¤æ—¶é—´</th>
                    <th style="padding: 1rem; text-align: center; color: #5a4a3a; font-weight: 600;">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for novel in novels %}
                <tr style="border-bottom: 1px solid #f0e6d6; transition: all 0.3s;"
                    onmouseover="this.style.background='#faf8f3'"
                    onmouseout="this.style.background='transparent'">
                    <td style="padding: 1rem; color: #8b7355; font-size: 0.9rem;">{{ novel.novelId }}</td>
                    <td style="padding: 1rem; color: #333; font-weight: 500;">{{ novel.title }}</td>
                    <td style="padding: 1rem; text-align: center; color: #666;">{{ novel.author_name }}</td>
                    <td style="padding: 1rem; text-align: center;">
                        <span class="badge badge-primary">{{ novel.category }}</span>
                    </td>
                    <td style="padding: 1rem; text-align: center; color: #666;">{{ novel.chapters|length }}</td>
                    <td style="padding: 1rem; text-align: center; color: #8b7355; font-size: 0.95rem;">
                        {{ novel.createTime.strftime('%Y-%m-%d %H:%M') if novel.createTime else '-' }}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <div style="display: flex; gap: 0.5rem; justify-content: center;">
                            <button class="btn btn-success" style="padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="reviewNovel('{{ novel._id }}', 'approve')">âœ… é€šè¿‡</button>
                            <button class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);" onclick="rejectNovel('{{ novel._id }}')">âŒ é©³å›</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="icon">âœ…</div>
        <h3>æš‚æ— å¾…å®¡æ ¸çš„å°è¯´</h3>
        <p>æ‰€æœ‰å°è¯´å·²å®¡æ ¸å®Œæ¯•</p>
    </div>
    {% endif %}
</div>

<!-- é©³å›åŸå› å¼¹çª— -->
<div id="rejectModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(4px);">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fdfcfa; padding: 2rem; border-radius: 16px; border: 2px solid #f0e6d6; width: 90%; max-width: 500px; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
        <h3 style="color: #5a4a3a; font-size: 1.5rem; margin-bottom: 1.5rem;">âŒ é©³å›åŸå› </h3>
        <form id="rejectForm" method="POST">
            <div class="form-group">
                <label for="opinion" style="color: #5a4a3a; font-weight: 600; margin-bottom: 0.5rem; display: block;">è¯·è¾“å…¥é©³å›åŸå› ï¼š</label>
                <textarea id="opinion" name="opinion" class="form-control" required style="min-height: 120px; border: 2px solid #f0e6d6; border-radius: 8px; padding: 1rem;"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-danger" style="flex: 1; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">ç¡®è®¤é©³å›</button>
                <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeRejectModal()">å–æ¶ˆ</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function reviewNovel(novelId, action) {
    if (!confirm('ç¡®å®šè¦é€šè¿‡è¿™éƒ¨å°è¯´å—ï¼Ÿ')) return;
    
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/admin/review/' + novelId;
    
    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = action;
    form.appendChild(actionInput);
    
    const opinionInput = document.createElement('input');
    opinionInput.type = 'hidden';
    opinionInput.name = 'opinion';
    opinionInput.value = 'å®¡æ ¸é€šè¿‡';
    form.appendChild(opinionInput);
    
    document.body.appendChild(form);
    form.submit();
}

function rejectNovel(novelId) {
    const modal = document.getElementById('rejectModal');
    const form = document.getElementById('rejectForm');
    form.action = '/admin/review/' + novelId;
    
    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = 'reject';
    form.appendChild(actionInput);
    
    modal.style.display = 'block';
}

function closeRejectModal() {
    document.getElementById('rejectModal').style.display = 'none';
    document.getElementById('opinion').value = '';
}
</script>
{% endblock %}
